/*
 *
 * Wijmo Library 2.0.3
 * http://wijmo.com/
 *
 * Copyright(c) ComponentOne, LLC.  All rights reserved.
 * 
 * Dual licensed under the Wijmo Commercial or GNU GPL Version 3 licenses.
 * licensing@wijmo.com
 * http://wijmo.com/license
 *
 *
 **/
(function(a){"use strict";a.widget("wijmo.wijpiechart",a.wijmo.wijchartcore,{options:{radius:null,innerRadius:0,animation:{enabled:true,duration:400,easing:">",offset:10},seriesTransition:{enabled:true,duration:1e3,easing:"bounce"},seriesList:[],mouseDown:null,mouseUp:null,mouseOver:null,mouseOut:null,mouseMove:null,click:null},_create:function(){var b=this,c=b._getDefFill();a.wijmo.wijchartcore.prototype._create.apply(b,arguments);b.chartElement.addClass("wijmo-wijpiechart");a.each(this.options.seriesStyles,function(b,a){if(!a.fill)a.fill=c[b]})},destroy:function(){var f=this,e=f.chartElement,b=e.data("fields"),c=b&&b.sectors,d=b&&b.labels;e.removeClass("wijmo-wijpiechart");a.wijmo.wijchartcore.prototype.destroy.apply(this,arguments);c&&c.length&&a.each(c,function(b,a){a=null});d&&d.length&&a.each(d,function(b,a){a=null});e.data("fields",null)},_isPieChart:function(){return true},getSector:function(b){var a=this.chartElement.data("fields");return a&&a.chartElements?a.chartElements.sectors[b]:null},_getSeriesFromTR:function(i,e,h){var d=null,g=null,b=null,f=null,c=null;e.length&&e.each(function(){g=a("th",a(this));d=a.trim(g.text());b=a("td",a(this));if(b.length)f=parseFloat(a.trim(a(b[0]).text()));c={label:d,legendEntry:true,data:f};h.push(c)})},_showSerieEles:function(a){var b=this.options.showChartLabels;if(a.sector){a.sector.show();a.sector.shadow&&a.sector.shadow.show();a.sector.tracker&&a.sector.tracker.show()}a.label&&b&&a.label.show()},_hideSerieEles:function(a){if(a.sector){a.sector.hide();a.sector.shadow&&a.sector.shadow.hide();a.sector.tracker&&a.sector.tracker.hide()}a.label&&a.label.hide()},_hasAxes:function(){return false},_mouseDown:function(){a.wijmo.wijchartcore.prototype._mouseDown.apply(this,arguments)},_mouseUp:function(){a.wijmo.wijchartcore.prototype._mouseUp.apply(this,arguments)},_mouseOver:function(){a.wijmo.wijchartcore.prototype._mouseOver.apply(this,arguments)},_mouseOut:function(){a.wijmo.wijchartcore.prototype._mouseOut.apply(this,arguments)},_mouseMove:function(){a.wijmo.wijchartcore.prototype._mouseMove.apply(this,arguments)},_click:function(){a.wijmo.wijchartcore.prototype._click.apply(this,arguments)},_paintTooltip:function(){var c=this,d=c.chartElement,b=d.data("fields");a.wijmo.wijchartcore.prototype._paintTooltip.apply(this,arguments);if(c.tooltip&&b)if(b.trackers&&b.trackers.length){c.tooltip.setSelector(a(".wijchart-canvas-object",d[0]));c.tooltip.setOptions({relatedElement:b.trackers[0]})}},_paintPlotArea:function(){var b=this,c=b.options,e=b.canvasBounds,g=e.endX-e.startX,f=e.endY-e.startY,d=c.radius;if(!d)d=Math.min(g,f)/2;else{if(g<2*d)d=g/2;if(f<2*d)d=f/2}c.radius=d;e.startX+=g/2-d;e.endX=e.startX+2*d;e.startY+=f/2-d;e.endY=e.startY+2*d;if(b.chartElement.data("fields"))b.chartElement.data("fields").seriesEles=null;b.chartElement.wijpie({canvas:b.canvas,tooltip:b.tooltip,bounds:e,radius:d,widgetName:b.widgetName,innerRadius:c.innerRadius,seriesList:c.seriesList,seriesStyles:c.seriesStyles,seriesHoverStyles:c.seriesHoverStyles,seriesTransition:c.seriesTransition,showChartLabels:c.showChartLabels,disabled:c.disabled,textStyle:c.textStyle,chartLabelStyle:c.chartLabelStyle,shadow:c.shadow,animation:c.animation,mouseDown:a.proxy(b._mouseDown,b),mouseUp:a.proxy(b._mouseUp,b),mouseOver:a.proxy(b._mouseOver,b),mouseOut:a.proxy(b._mouseOut,b),mouseMove:a.proxy(b._mouseMove,b),click:a.proxy(b._click,b)})},_getTooltipText:function(e,d){var c=a(d.node),b,f;if(c.data("owner"))c=c.data("owner");b=c.data("wijchartDataObj");f={data:b,value:b.value,label:b.label,total:b.total,target:d,fmt:e};return a.proxy(e,f)()}})})(jQuery);(function(a){"use strict";a.fn.extend({wijpie:function(b){var A=function(c,d,e){b.shadow&&a.wijchart.paintShadow(c,d,e)},z=a.wijchart.getDiffAttrs,u=a.wijraphael.addClass,q=a.wijraphael.getPositionByAngle,c=this,L=b.bounds,g=b.widgetName,h=b.canvas,e=b.animation,E=b.seriesList,S=b.seriesStyles,N=b.seriesHoverStyles,l=b.radius,n=b.innerRadius,j=b.seriesTransition,Q=b.showChartLabels,P=b.chartLabelStyle,k=b.disabled,F=b.mouseDown,J=b.mouseUp,H=b.mouseOver,I=b.mouseOut,G=b.mouseMove,M=b.click,K=b.tooltip,d=c.data("fields")||{},m=d.chartElements||{},r=d.aniSectorAttrs,s=d.aniLabelAttrs,B=[],C=[],w=[],o=[],t=[],i=0,x=0,T=L.startX,U=L.startY,D=[],y,f,p;function R(){var b={x:0,y:0},d=a.isFunction;K&&K.setTargets(t);a(".wijpiechart",c[0]).live("mousedown."+g,function(f){if(k)return;var b=a(f.target),e;if(b.data("owner"))b=b.data("owner");e=b.data("wijchartDataObj");if(!e)return;d(F)&&F.call(c,f,e)}).live("mouseup."+g,function(f){if(k)return;var b=a(f.target),e;if(b.data("owner"))b=b.data("owner");e=b.data("wijchartDataObj");if(!e)return;d(J)&&J.call(c,f,e)}).live("mouseover."+g,function(o){if(k)return;var l=a(o.target),h,n,p=e&&e.enabled,m,f,g,i,j;if(l.data("owner"))l=l.data("owner");h=l.data("wijchartDataObj");if(!h)return;n=h.pieID||"";m=h.index;f=c.data("fields").chartElements["sectors"+n][m];g=f.showAnimationTimer;i=f.hideAnimationTimer;j=f.explodeAnimationShowing;d(H)&&H.call(c,o,h);if(f.removed)return;f.wijAttr(h.hoverStyle);if(p){if(i){window.clearTimeout(i);i=null;f.hideAnimationTimer=i}if(g){window.clearTimeout(g);g=null;f.showAnimationTimer=null}if(j)return;g=window.setTimeout(function(){var a=e.duration,c=e.easing;if(f.removed)return;b=f.getOffset(e.offset||10);f.offset=b;f.wijAnimate({transform:Raphael.format("t{0},{1}",b.x,b.y)},a,c);f.tracker&&!f.tracker.removed&&f.tracker.wijAnimate({transform:Raphael.format("t{0},{1}",b.x,b.y)},a,c);j=true;f.explodeAnimationShowing=j},150);f.showAnimationTimer=g}}).live("mouseout."+g,function(o){if(k)return;var l=a(o.target),g,n,p=e&&e.enabled,m,f,i,h,j;if(l.data("owner"))l=l.data("owner");g=l.data("wijchartDataObj");if(!g)return;n=g.pieID||"";m=g.index;f=c.data("fields").chartElements["sectors"+n][m];i=f.showAnimationTimer;h=f.hideAnimationTimer;j=f.explodeAnimationShowing;d(I)&&I.call(c,o,g);if(f.removed)return;if(g.style.segment)delete g.style.segment;f.wijAttr(g.style);if(p){if(h){window.clearTimeout(h);h=null;f.hideAnimationTimer=h}if(i){window.clearTimeout(i);i=null;f.showAnimationTimer=i}if(!j)return;h=window.setTimeout(function(){var a=e.duration,c=e.easing;b=f.offset;!f.removed&&f.wijAnimate({transform:"t0,0"});f.tracker&&!f.tracker.removed&&f.tracker.wijAnimate({transform:"t0,0"});b={x:0,y:0};j=false;f.explodeAnimationShowing=j},150);f.hideAnimationTimer=h}}).live("mousemove."+g,function(f){if(k)return;var b=a(f.target),e;if(b.data("owner"))b=b.data("owner");e=b.data("wijchartDataObj");if(!e)return;d(G)&&G.call(c,f,e)}).live("click."+g,function(f){if(k)return;var b=a(f.target),e;if(b.data("owner"))b=b.data("owner");e=b.data("wijchartDataObj");if(!e)return;d(M)&&M.call(c,f,e)})}function O(){a(".wijpiechart",c[0]).die(g).die("."+g)}h.customAttributes.segment=function(h,i,d,b,g,f){var e=null,c=.01;if(b-d>360-c)b-=c;else if(b-d<c)b+=c;if(f)e=a.wijchart.donut(h,i,g,f,d,b);else e=a.wijchart.sector(h,i,g,d,b);return{path:e}};a.each(E,function(b,a){if(a&&typeof a.data==="number")x+=a.data});var v=h.set();a.each(E,function(d,c){var m=a.extend({opacity:1,stroke:"gray","stroke-width":1},S[d]),H=360*c.data/x,E=T+l,F=U+l,I,b,k,G,e,g;p=c.pieID;c=a.extend(true,{offset:0},c);if(c.offset){I=q(E,F,c.offset,i+H/2);E=I.x;F=I.y}y=[E,F,i,i+H,l,n].concat(" ");if(r&&j.enabled){m.segment=y;if(d<r.length)f=r[d];else{f=a.extend(true,{},m);f.segment=[E,F,0,360,l,n].concat(" ")}b=h.path().attr(f);m=z(f,m);!b.removed&&b.wijAnimate(m,j.duration,j.easing,function(){A(b);g&&!g.removed&&!b.removed&&g.attr({path:b.attr("path")});delete m.segment})}else{b=h.path().attr({segment:y});A(b);b.wijAttr(m)}b.angles={start:i,end:i+H};b.getOffset=function(c){var a=q(E,F,c,(b.angles.start+b.angles.end)/2);return{x:a.x-E,y:a.y-F}};b.center={x:E,y:F};b.radius=l;if(n)b.innerRadius=n;g=b.clone();if(a.browser.msie&&a.browser.version<9)g.attr({opacity:.01,fill:"white","stroke-width":0,"fill-opacity":.01});else g.attr({opacity:.01,fill:"white","fill-opacity":.01});u(a(g.node),"wijchart-canvas-object wijpiechart pietracker wijchart-tracker"+d);a(g.node).data("owner",a(b.node));b.tracker=g;v.push(g);u(a(b.node),"wijchart-canvas-object wijpiechart wijmo-wijpiechart-series-"+d);a(b.node).data("wijchartDataObj",c);if(Q){G=q(E,F,c.offset+l*2/3,i+H/2);e=a.extend(true,{},e,P);if(c.textStyle)e=a.extend(true,e,c.textStyle);if(s&&j.enabled)if(d<s.length){f=s[d];f.text=c.label;k=h.text(0,0,"").attr(f);e=z(f,e);e.x=G.x;e.y=G.y;k.wijAnimate(e,j.duration,j.easing)}else k=h.text(G.x,G.y,c.label).attr(e);else k=h.text(G.x,G.y,c.label).attr(e);u(a(k.node),"wijchart-canvas-object wijpiechart");a(k.node).data("wijchartDataObj",c);t.push(k);o.push(k);C[d]=k.attr()}D.push({label:o[d],sector:b});B[d]=b.attr();w.push(b);t.push(b);c.style=m;c.hoverStyle=N[d];c.index=d;c.value=c.data;c.y=c.data;c.total=x;c.type="pie";i+=H});m.sectors=w;if(p){m["sectors"+p]=w;m["labels"+p]=o}m.labels=o;if(!d.chartElements)d.chartElements={};v.toFront();a.extend(true,d.chartElements,m);d.aniSectorAttrs=B;d.aniLabelAttrs=C;d.seriesEles=D;d.trackers=v;c.data("fields",d);O();R()}})})(jQuery);