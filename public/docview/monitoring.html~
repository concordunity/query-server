<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
    <title>存量单证电子化管理系统-监控</title>

    <link href="/docview/bootstrap/bootstrap.css" rel="stylesheet">
    <link href="/docview/bootstrap/bootstrap-responsive.css" rel="stylesheet">
 
  </head>
  <body>

<h3>存量单证电子化管理系统-系统状态信息</h3>


<div class="btn-group">
  <a class="btn btn-success dropdown-toggle" data-toggle="dropdown" href="#">
    选择服务器
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu">
     <li><a href="#david-server">查询服务器</a><li>
     <li><a href="#dms-proxy1">存储代理</a><li>
     <li><a href="#dms-storage-node1">存储服务器 1</a><li>
     <li><a href="#dms-storage-node2">存储服务器 2</a><li>
     <li><a href="#dms-storage-node3">存储服务器 3</a><li>
     <li><a href="#dms-storage-node4">存储服务器 4</a><li>
     <li><a href="#dms-storage-node5">存储服务器 5</a><li>
  </ul>
</div>

目前显示： <span class="server-name"></span>

<ul class="thumbnails">
  <li class="span6">
    <div id="cpu-info" class="thumbnail">
    </div>
  </li>

    <li class="span6">
    <div id="disk-info" class="thumbnail">
    </div>
  </li>

    <li class="span6">
    <div id="mem-info" class="thumbnail">
    </div>
  </li>

    <li class="span6">
    <div id="df-util" class="thumbnail">
    </div>
  </li>

</ul>

<script type='text/javascript' src='../steal/steal.js'></script>
<script type='text/javascript'>

/* Global function */
function convert_df_label_to_name(label) {
 var re = /mount=([\w\/]+ )/;
 var mr = re.exec(label);

 if (mr) {
   return mr[1];
 } else {
   return label; 
 }
}

steal('jquery/dom/route', 'docview/ui/graphing')
.then('libs/development-bundle/ui/jquery-ui-1.8.19.custom.js', 'docview/bootstrap/bootstrap-dropdown.js')
.then(function($) {

Highcharts.setOptions({
global : {
useUTC : false
}
});


$('.dropdown-toggle').dropdown();
var cpu_options = {
url: "/monitoring/query",
varname : "proc.loadavg.5min",
y_label: '',
x_label: '5min load',
title: 'CPU 平均负载',
initial_minutes: 120,
update_seconds: 30
};

var disk_options = {
 url: "/monitoring/query",
 varname : "df.1kblocks.used",
 y_label: '',
 x_label: '',
 title: '磁盘分区占用（KB）',
 initial_minutes: 600,
 label_mapper : convert_df_label_to_name,
 update_seconds: 180
};

var mem_options = {
  url: "/monitoring/query_util",
  varname : "",
  extra_params : { type : 'mem' },
  y_label: '',
  x_label: '系统内存',
  title: '内存使用率（%）',
  initial_minutes: 240,
  update_seconds: 30
};

var df_util_options = {
  url: "/monitoring/query_util",
  varname : "",
  extra_params : { type : 'df' },
  y_label: '',
  x_label: '',
  title: '磁盘分区占用率（%）',
  initial_minutes: 600,
  update_seconds: 180
};


$('#cpu-info').docview_ui_graphing({ plot_options : cpu_options });
$('#cpu-info').docview_ui_graphing('loadDataForHost', 'david-server');

$('#disk-info').docview_ui_graphing({ plot_options : disk_options });
$('#disk-info').docview_ui_graphing('loadDataForHost', 'david-server');
$('#mem-info').docview_ui_graphing({ plot_options : mem_options });
$('#mem-info').docview_ui_graphing('loadDataForHost', 'david-server');


$('#df-util').docview_ui_graphing({ plot_options : df_util_options });
$('#df-util').docview_ui_graphing('loadDataForHost', 'david-server');
});

</script>
</body>
</html>

