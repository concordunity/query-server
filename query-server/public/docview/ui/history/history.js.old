steal(
	'jquery/controller',
	'jquery/view/ejs',
    'jquery/controller/view',
    'jquery/dom/route',
    'jquery/lang/observe/delegate',
    'docview/models',
    'docview/bootstrap/bootstrap.css'
)

// View templates
.then(
    './views/history.ejs',
    './views/history_row.ejs'
) // External JS
.then(
    'docview/datatables/jquery.dataTables.js'
)
.then(
    'docview/datatables/bootstrap-pagination.js'
)

.then(function($) {
    $.Controller('Docview.History',
    /* @Static */
    {
    }, {
        init: function() {
	    $.ajax({
		url: '/qh_all',
		type: 'get',
		success : this.proxy('showResult'),
		error : this.proxy('failure'),
		dataType: 'json'
	    });
        },

	showResult : function(data) {
	    this.element.html(this.view('history', data));
	    this.element.find('table').dataTable({
                "sDom": "<'row-fluid'<'span6'l><'pull-right'f>r>t<'row-fluid'<'span6'i><'pull-right'p>>",
		"iDisplayLength": 100,
                "sPaginationType": "bootstrap",
                "oLanguage" : {
                    "sUrl" : "media/language/ch_ZN.txt"
                 }
            });
	},
	failure : function(data) {
	    console.log(data);
	}
    });
});