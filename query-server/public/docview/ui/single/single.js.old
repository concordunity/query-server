steal(
	'jquery/controller',
	'jquery/view/ejs',
    'jquery/controller/view',
    'jquery/lang/observe/delegate',
    'docview/bootstrap/bootstrap.css'
).then(
    './views/init.ejs')

.then(function($) {
  $.Controller('Docview.Single', {},
    {
	init: function() {
            this.element.html(this.view('init'));
	    this.id = '';
      },
      show: function() {
	  this.element.show();
      }, 
	getId : function() {
            return this.id;
        },
	validateInput: function(el) {
	    this.removeFormErrors(el);
	    var docId = $.trim(el.find('.query').val());
	    if (this.verifyDocId(docId)) {
		this.id = docId;
		return true;
	    }

	    this.displayInputError(el, "query", "单证号必须是18位数字。");
	},
	// Verifies individual document ids
        verifyDocId: function(id) {
            return /^\d{18}$/.test(id);
        },
	removeFormErrors: function(form) {
            form.find('.error .help-inline').remove();
            form.find('.error').removeClass('error');
        },
	displayInputError: function(form, name, message) {
            var inputField = form.find('input[name="' + name + '"]');
            inputField.closest('.control-group').addClass('error');
            inputField.after('<span class="help-inline">' + message + '</span>');
        }
    });
});
