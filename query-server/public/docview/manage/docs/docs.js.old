steal(
	'jquery/controller',
	'jquery/view/ejs',
    'jquery/controller/view',
    'jquery/dom/route',
    'jquery/lang/observe/delegate',
    'docview/models',
    'docview/multi',
    'docview/single',
    'docview/bootstrap/bootstrap.css',
    'libs/datepicker/css/datepicker.css'
)

// View templates
.then(
    './views/init.ejs'
)

// External JS
.then(
    'docview/bootstrap/bootstrap-collapse.js',
    'libs/datepicker/js/bootstrap-datepicker.js'
)

.then(function($) {

    /*
    * Search box containing three types of search:
    *   - document id
    *   - multiple document ids
    *   - advanced search
    */
    $.Controller('Docview.Manage.Docs',
    /* @Static */
    {
    },
    /* @Prototype */
    {
        init: function() {
            this.element.html(this.view('init', {}));

            // Hide box until route conditions are met
            this.element.hide();

	    // attach controller.
	    this.element.find('.inquire').hide();
            this.element.find('.checkout').hide();
            this.element.find('.print_doc').hide();
            this.element.find('.court_doc').hide();

	    $('#manage-docs-container div form div.multi_holder').docview_multi({});
	    $('#manage-docs-container div form div.single_holder').docview_single({});

            this.mainTabOn = false;
        },
        '{$.route} category change': function(el, ev, attr, how, newVal, oldVal)  {
            if (newVal === "manage_docs") {
                this.element.show();
		this.mainTabOn = true;
            }
            else {
                this.element.hide();
		this.mainTabOn = false;
            }
        },
        '{$.route} subcategory change': function(el, ev, attr, how, newVal, oldVal)  {
	    if (this.mainTabOn) {
		if (oldVal !== undefined) {
                    this.element.find('.' + oldVal).hide();
		}
		if (newVal !== undefined) {
                    this.element.find('.' + newVal).show();
		} else {
		    this.element.find('.inqure').show();
		}
	    }
        },

	'.inquire submit' : function(el, ev) {
	    ev.preventDefault();
	    $('#manage-docs-container div form.inquire div.multi_holder').docview_multi("validateInput", el);	    
	},
	'.checkout submit' : function(el, ev) {
	    ev.preventDefault();
	    var ctrl = $('#manage-docs-container div form.checkout div.multi_holder').controller();
	    if (ctrl.validateInput(el)) {	    
		
	    }
	},
	'.court_doc submit' : function(el, ev) {
	    ev.preventDefault();

	    var ctrl = $('#manage-docs-container div form.court_doc div.single_holder').controller();

	    if (ctrl.validateInput(el)) {
		var docId = ctrl.getId();
                $.route.attr('old', 'court'); 
		$.route.attrs({category: 'document', id: docId}, true);
		
		this.element.hide();
	    }	    
   
	},
	'.print_doc submit' : function(el, ev) {
	    ev.preventDefault();
	    var ctrl = $('#manage-docs-container div form.print_doc div.single_holder').controller();
	    if (ctrl.validateInput(el)) {
		var docId = ctrl.getId();
                $.route.attrs({category: 'document', id: docId}, true);
		this.element.hide();
	    }	    

	}

    });
});
